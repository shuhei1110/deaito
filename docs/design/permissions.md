# アルバム権限モデル（A案: メンバー全員参加型）

## ロール定義

| ロール | 説明 |
|---|---|
| **owner** | アルバム作成者。全権限を持つ。1アルバムに1人 |
| **admin** | 幹事・モデレーター。他人の投稿管理や参加承認が可能 |
| **member** | 一般メンバー。イベント作成・メディアアップロードが可能 |

## 権限マトリクス

### アルバム管理

| アクション | owner | admin | member |
|---|---|---|---|
| アルバム設定変更（名前・カテゴリ・公開範囲） | ✅ | ❌ | ❌ |
| アルバム削除 | ✅ | ❌ | ❌ |
| 招待コード確認・再生成 | ✅ | ✅ | ❌ |
| 参加リクエスト承認・拒否 | ✅ | ✅ | ❌ |
| メンバー退出させる | ✅ | ❌ | ❌ |
| メンバーのロール変更 | ✅ | ❌ | ❌ |

### イベント操作

| アクション | owner | admin | member |
|---|---|---|---|
| イベント作成 | ✅ | ✅ | ✅ |
| 自分が作成したイベントの編集・削除 | ✅ | ✅ | ✅ |
| 他人が作成したイベントの編集・削除 | ✅ | ✅ | ❌ |

### メディア操作

| アクション | owner | admin | member |
|---|---|---|---|
| メディアアップロード | ✅ | ✅ | ✅ |
| 自分がアップロードしたメディアの削除 | ✅ | ✅ | ✅ |
| 他人がアップロードしたメディアの削除 | ✅ | ✅ | ❌ |
| コメント投稿 | ✅ | ✅ | ✅ |
| リアクション（いいね） | ✅ | ✅ | ✅ |

### 閲覧

| アクション | owner | admin | member |
|---|---|---|---|
| イベント一覧・詳細の閲覧 | ✅ | ✅ | ✅ |
| メディアの閲覧 | ✅ | ✅ | ✅ |
| メンバー一覧の閲覧 | ✅ | ✅ | ✅ |
| つながりグラフの閲覧 | ✅ | ✅ | ✅ |

## RLSポリシーとの対応

### events テーブル

- **SELECT**: アルバムメンバー or 公開アルバム → 全ロール可
- **INSERT**: アルバムのactiveメンバー（`created_by = auth.uid()`）→ 全ロール可
- **UPDATE/DELETE**: 作成者本人 or owner/admin

### media_assets テーブル

- **SELECT**: アルバムメンバー or 公開アルバム → 全ロール可
- **INSERT**: アルバムのactiveメンバー（`uploader_id = auth.uid()`）→ 全ロール可
- **UPDATE/DELETE**: アップロード者本人 or owner/admin

## 設計方針

- 卒業アルバムは「クラスメイト全員が写真を追加し合う」ものなので、投稿系は全メンバーに開放
- adminは「幹事」的な立場で、不適切な投稿の削除や参加リクエスト承認を担当
- ownerのみがアルバム設定とメンバー管理（退出・ロール変更）を実行可能
- 破壊的操作（アルバム削除）はownerに限定
